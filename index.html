<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burgherr WebApp - Optimized UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=MedievalSharp&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-body: #2b2b2b;
            --bg-panel: #fdf6e3; /* Solarized Light Creme */
            --primary: #8b5e3c;   /* Leder */
            --primary-dark: #5d4037;
            --secondary: #37474f; /* Dunkles Blau-Grau f√ºr Panels */
            --accent: #d32f2f;    /* Rot */
            --highlight: #f9a825; /* Goldgelb */
            --text-main: #333333;
            --text-light: #f1f1f1;
            --border-radius: 8px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            justify-content: center;
        }

        #app {
            background-color: var(--bg-panel);
            width: 100%;
            max-width: 1400px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- NEUER HEADER (DASHBOARD STYLE) --- */
        header {
            background-color: var(--secondary);
            color: var(--text-light);
            padding: 10px 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            border-bottom: 4px solid var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .header-title h1 {
            font-family: 'MedievalSharp', cursive;
            margin: 0;
            font-size: 1.6rem;
            color: var(--highlight);
            text-shadow: 2px 2px 0 #000;
            margin-right: 20px;
        }

        /* Ressourcen Container */
        .res-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
            justify-content: flex-end;
        }

        /* Einzelne Gruppe (z.B. Lager) */
        .res-group {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 5px 10px;
            display: flex;
            flex-direction: column;
            min-width: 140px;
        }

        .res-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            opacity: 0.7;
            margin-bottom: 4px;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 2px;
        }

        .res-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 10px;
        }

        .res-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .res-icon { font-size: 1.2rem; margin-bottom: -2px; }
        .res-val { 
            font-weight: 900; 
            font-size: 1.1rem;
            color: #fff;
        }
        
        /* Spezifische Farben f√ºr Zahlen */
        .gold-val { color: var(--highlight); }
        .pop-val { color: #81c784; }

        /* --- MAIN LAYOUT --- */
        main { display: flex; flex: 1; overflow: hidden; }

        /* SIDEBARS */
        aside {
            width: 300px;
            background-color: #f4ecd8;
            padding: 15px;
            overflow-y: auto;
            border-right: 1px solid #dccbb1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        aside.right { border-right: none; border-left: 1px solid #dccbb1; }

        h2 {
            font-family: 'MedievalSharp', cursive;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary);
            font-size: 1.3rem;
            margin: 0 0 10px 0;
            padding-bottom: 5px;
        }

        /* BUTTONS */
        .btn-group { display: flex; flex-direction: column; gap: 8px; }

        button {
            background-color: #fff;
            border: 1px solid #cbb092;
            border-left: 5px solid var(--primary);
            color: var(--text-main);
            padding: 10px 14px;
            border-radius: 4px;
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        button:hover:not(:disabled) {
            background-color: var(--primary);
            color: white;
            transform: translateX(4px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }
        
        button:disabled { opacity: 0.5; cursor: not-allowed; border-left-color: #777; background: #eee; }
        
        button.military { border-left-color: var(--accent); }
        button.food { border-left-color: #2e7d32; }

        .cost { font-size: 0.75rem; font-weight: normal; opacity: 0.8; }
        button:hover .cost { opacity: 1; color: #eee; }

        /* LOG AREA */
        #log-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            gap: 8px;
            /* Hintergrund Muster leicht angedeutet */
            background-image: radial-gradient(#f4e4bc 10%, transparent 10%), radial-gradient(#f4e4bc 10%, transparent 10%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            background-color: #ffffff;
        }

        .log-entry {
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            border-left: 4px solid #ccc;
            background: #fcfcfc;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            line-height: 1.4;
        }
        .log-entry strong { color: var(--primary-dark); }
        
        /* Log Typen */
        .log-entry.combat { border-left-color: var(--accent); background-color: #ffebee; color: #b71c1c; }
        .log-entry.economy { border-left-color: #2e7d32; background-color: #e8f5e9; font-size: 0.9rem; color: #1b5e20; }
        .log-entry.important { border-left-color: #f9a825; background-color: #fffde7; border: 1px solid #fff9c4; border-left-width: 4px; }

        /* MODAL */
        #modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(2px);
        }
        #modal-box {
            background: #fdf6e3;
            width: 500px;
            padding: 30px;
            border: 2px solid var(--primary);
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        #modal-title { font-family: 'MedievalSharp'; font-size: 2rem; color: var(--accent); margin-bottom: 15px; }
        #modal-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px; }
        #modal-btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px; font-size: 1.1rem; 
            border-radius: 6px; cursor: pointer; transition: background 0.2s;
        }
        #modal-btn:hover { background: var(--primary-dark); }
        
        /* Tooltip-Hilfe f√ºr Icons (simpel) */
        .res-item:hover::after {
            content: attr(title);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 4px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 20;
            margin-top: 5px;
        }

    </style>
</head>
<body>

<div id="modal-overlay">
    <div id="modal-box">
        <div id="modal-title">Achtung, Sire!</div>
        <div id="modal-text">Hier steht der Text.</div>
        <button id="modal-btn" onclick="UI.closeModal()">Verstanden</button>
    </div>
</div>

<div id="app">
    <header>
        <div class="header-title">
            <h1>üè∞ Der Burgherr</h1>
        </div>
        
        <div class="res-container">
            <div class="res-group">
                <div class="res-label">Lager & Schatz</div>
                <div class="res-items">
                    <div class="res-item" title="Gold">
                        <span class="res-icon">üí∞</span>
                        <span class="res-val gold-val" id="res-gold">0</span>
                    </div>
                    <div class="res-item" title="Holz">
                        <span class="res-icon">üå≤</span>
                        <span class="res-val" id="res-wood">0</span>
                    </div>
                    <div class="res-item" title="Stein">
                        <span class="res-icon">üß±</span>
                        <span class="res-val" id="res-stone">0</span>
                    </div>
                    <div class="res-item" title="Eisen">
                        <span class="res-icon">‚õìÔ∏è</span>
                        <span class="res-val" id="res-iron">0</span>
                    </div>
                </div>
            </div>

            <div class="res-group">
                <div class="res-label">Kornspeicher</div>
                <div class="res-items">
                    <div class="res-item" title="Getreide">
                        <span class="res-icon">üåæ</span>
                        <span class="res-val" id="res-wheat">0</span>
                    </div>
                    <div class="res-item" title="Mehl">
                        <span class="res-icon">ü•°</span>
                        <span class="res-val" id="res-flour">0</span>
                    </div>
                    <div class="res-item" title="Brot (Sehr nahrhaft)">
                        <span class="res-icon">üçû</span>
                        <span class="res-val" id="res-bread">0</span>
                    </div>
                    <div class="res-item" title="Fleisch">
                        <span class="res-icon">ü•©</span>
                        <span class="res-val" id="res-meat">0</span>
                    </div>
                    <div class="res-item" title="√Ñpfel">
                        <span class="res-icon">üçé</span>
                        <span class="res-val" id="res-apple">0</span>
                    </div>
                </div>
            </div>

            <div class="res-group">
                <div class="res-label">Das Reich</div>
                <div class="res-items">
                    <div class="res-item" title="Waffen">
                        <span class="res-icon">‚öîÔ∏è</span>
                        <span class="res-val" id="res-weapon">0</span>
                    </div>
                    <div class="res-item" title="Soldaten">
                        <span class="res-icon">üõ°Ô∏è</span>
                        <span class="res-val" id="res-soldier">0</span>
                    </div>
                    <div class="res-item" title="Beliebtheit">
                        <span class="res-icon">‚ù§Ô∏è</span>
                        <span class="res-val pop-val" id="res-pop">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <aside>
            <h2>Rohstoffe</h2>
            <div class="btn-group">
                <button onclick="Game.build('woodcutter')">Holzf√§ller <span class="cost">15üí∞</span></button>
                <button onclick="Game.build('quarry')">Steinbruch <span class="cost">50üí∞ 20üå≤</span></button>
                <button onclick="Game.build('ironmine')">Eisenmine <span class="cost">100üí∞ 50üå≤</span></button>
                <button onclick="Game.build('house')">H√ºtte <span class="cost">10üå≤</span></button>
            </div>

            <h2>Nahrungskette</h2>
            <div class="btn-group">
                <button onclick="Game.build('farm_apple')" class="food">Apfelgarten <span class="cost">30üí∞ 10üå≤</span></button>
                <button onclick="Game.build('hunter')" class="food">J√§gerstand <span class="cost">20üí∞ 5üå≤</span></button>
                <button onclick="Game.build('farm_wheat')" class="food">Getreidefarm <span class="cost">40üí∞ 10üå≤</span></button>
                <button onclick="Game.build('mill')" class="food">M√ºhle <span class="cost">80üí∞ 30üå≤ 10üß±</span></button>
                <button onclick="Game.build('bakery')" class="food">B√§ckerei <span class="cost">60üí∞ 20üå≤</span></button>
            </div>

            <h2>Milit√§r & Waffen</h2>
            <div class="btn-group">
                <button onclick="Game.build('weaponsmith')" class="military">Waffenschmiede <span class="cost">100üí∞ 20üß±</span></button>
                <button onclick="Game.build('barracks')" class="military">Kaserne <span class="cost">150üí∞ 50üß±</span></button>
                <button onclick="Game.recruit()" class="military" id="btn-recruit">Soldat <span class="cost">10üí∞ 1‚öîÔ∏è</span></button>
            </div>
        </aside>

        <section id="log-area"></section>

        <aside class="right">
            <h2>Statusbericht</h2>
            <div class="stat-row"><strong>Tag:</strong> <span id="stat-day" style="font-size:1.2rem; font-weight:bold;">1</span></div>
            <div class="stat-row"><strong>Bewohner:</strong> <span id="stat-pop">0/0</span></div>
            <div class="stat-row"><strong>Steuersatz:</strong> <span id="stat-tax">0</span></div>
            
            <br>
            <h2>Geb√§ude</h2>
            <div class="stat-row">Holz/Stein/Eisen: <span id="count-basic">0/0/0</span></div>
            <div class="stat-row">Nahrungsbetriebe: <span id="count-food">0</span></div>
            <div class="stat-row">Milit√§rgeb√§ude: <span id="count-mil">0</span></div>

            <br>
            <h2>Verwaltung</h2>
            <div class="btn-group">
                <button onclick="Game.changeTax(1)">Steuern erh√∂hen</button>
                <button onclick="Game.changeTax(-1)">Steuern senken</button>
            </div>
        </aside>
    </main>
</div>

<script>
/* --- KONFIGURATION --- */
const Config = {
    tickRate: 5000, // JETZT: 5 Sekunden pro Tag (langsamer)
    combatStartDay: 15,
    buildings: {
        woodcutter: { costG: 15, costW: 0, costS: 0, name: "Holzf√§ller" },
        quarry:     { costG: 50, costW: 20, costS: 0, name: "Steinbruch" },
        ironmine:   { costG: 100, costW: 50, costS: 0, name: "Eisenmine" },
        house:      { costG: 0, costW: 10, costS: 0, capacity: 5, name: "H√ºtte" },
        
        farm_apple: { costG: 30, costW: 10, costS: 0, name: "Apfelgarten" },
        hunter:     { costG: 20, costW: 5, costS: 0, name: "J√§gerstand" },
        farm_wheat: { costG: 40, costW: 10, costS: 0, name: "Getreidefarm" },
        mill:       { costG: 80, costW: 30, costS: 10, name: "M√ºhle" },
        bakery:     { costG: 60, costW: 20, costS: 0, name: "B√§ckerei" },
        
        weaponsmith:{ costG: 100, costW: 0, costS: 20, name: "Waffenschmiede" },
        barracks:   { costG: 150, costW: 0, costS: 50, name: "Kaserne" }
    }
};

/* --- SPIELSTATUS --- */
const State = {
    day: 1,
    paused: false,
    
    // Ressourcen
    gold: 200, wood: 80, stone: 0, iron: 0,
    wheat: 0, flour: 0, 
    bread: 0, meat: 0, apple: 20,
    weapons: 0,

    // Bev√∂lkerung
    population: 5, maxPop: 10, popularity: 100, tax: 0, soldiers: 0,

    // Geb√§udez√§hler
    b: {
        woodcutter: 0, quarry: 0, ironmine: 0, house: 0,
        farm_apple: 0, hunter: 0, farm_wheat: 0, mill: 0, bakery: 0,
        weaponsmith: 0, barracks: 0
    },

    flags: { seenCombat: false, seenStarvation: false }
};

/* --- LOGIK --- */
const Game = {
    init: function() {
        UI.log("Willkommen, Sire! Das Tempo ist nun gem√§chlich (5s pro Tag).", "important");
        UI.update();
        // Loop Start
        setInterval(() => { if(!State.paused) this.tick(); }, Config.tickRate);
    },

    tick: function() {
        State.day++;

        // 1. Produktion
        State.wood += State.b.woodcutter * 2;
        State.stone += State.b.quarry * 1;
        State.iron += State.b.ironmine * 1;

        // 2. Nahrungskette
        State.apple += State.b.farm_apple * 3;
        State.meat += State.b.hunter * 2;
        State.wheat += State.b.farm_wheat * 2;

        // M√ºhle
        let millCapacity = State.b.mill * 2; 
        let wheatProcessed = Math.min(State.wheat, millCapacity);
        State.wheat -= wheatProcessed;
        State.flour += (wheatProcessed * 2);

        // B√§cker
        let bakeCapacity = State.b.bakery * 2;
        let flourProcessed = Math.min(State.flour, bakeCapacity);
        State.flour -= flourProcessed;
        let breadBaked = flourProcessed * 3;
        State.bread += breadBaked;

        if(breadBaked > 0) UI.log(`B√§cker backen ${breadBaked} Brot aus Mehl.`, "economy");

        // 3. Waffen
        let smithCapacity = State.b.weaponsmith;
        let ironProcessed = Math.min(State.iron, smithCapacity);
        State.iron -= ironProcessed;
        State.weapons += ironProcessed;
        if(ironProcessed > 0) UI.log(`Schmiede fertigen ${ironProcessed} Waffen.`, "economy");

        // 4. Verbrauch
        this.handleConsumption();

        // 5. Steuern
        if(State.tax > 0) {
            State.gold += (State.population * State.tax);
            State.popularity -= (State.tax * 2);
        }

        // 6. Kampf
        this.checkCombat();

        UI.update();
    },

    handleConsumption: function() {
        let needed = State.population;
        let eaten = 0;
        
        // Reihenfolge: Brot -> Fleisch -> Apfel
        let breadEat = Math.min(State.bread, needed);
        State.bread -= breadEat; needed -= breadEat; eaten += breadEat;

        let meatEat = Math.min(State.meat, needed);
        State.meat -= meatEat; needed -= meatEat; eaten += meatEat;

        let appleEat = Math.min(State.apple, needed);
        State.apple -= appleEat; needed -= appleEat; eaten += appleEat;

        if (needed > 0) {
            UI.log(`Hunger! ${needed} Siedler essen nichts.`, "combat");
            State.popularity -= 10;
            if(!State.flags.seenStarvation) {
                UI.showModal("Hungersnot!", "Sire, Euer Volk verhungert! Baut √Ñpfelg√§rten (schnell) oder Getreidefarmen (effizient).");
                State.flags.seenStarvation = true;
            }
        } else {
            // Brot Bonus
            if (breadEat > 0) State.popularity += 1; 
        }

        // Bev√∂lkerungswachstum
        if (State.popularity > 70 && State.population < State.maxPop && eaten >= State.population) {
            if(Math.random() > 0.6) { // Etwas h√∂here Chance wegen langsamerem Tick
                State.population++;
                UI.log("Ein neuer Siedler ist angekommen.", "important");
            }
        }
        
        if (State.popularity < 20 && State.population > 0) {
            State.population--;
            UI.log("Ein B√ºrger flieht vor Eurer Herrschaft.", "combat");
            State.popularity = 30;
        }
    },

    checkCombat: function() {
        if(State.day < Config.combatStartDay) return;
        
        // Da Tage l√§nger sind, leicht erh√∂hte Chance pro Tag (15%)
        if(Math.random() < 0.15) {
            if(!State.flags.seenCombat) {
                State.paused = true;
                UI.showModal("Zu den Waffen!", "Feinde wurden gesichtet! Eure Soldaten werden die Burg automatisch verteidigen. Verliert ihr, wird gepl√ºndert.");
                State.flags.seenCombat = true;
            }

            const enemyStrength = Math.floor(State.day * 1.5) + 5;
            const myStrength = State.soldiers * 10;
            
            UI.log(`ANGRIFF! Banditen (St√§rke ${enemyStrength})!`, "combat");
            
            if (myStrength >= enemyStrength) {
                UI.log(`SIEG! Eure Truppen haben gesiegt.`, "important");
                State.popularity += 5;
            } else {
                UI.log(`NIEDERLAGE! Wir wurden gepl√ºndert!`, "combat");
                State.gold = Math.floor(State.gold / 2);
                State.bread = 0;
                State.meat = 0;
                State.population = Math.max(1, State.population - 2);
                State.popularity -= 20;
            }
        }
    },

    build: function(type) {
        const b = Config.buildings[type];
        if (State.gold >= b.costG && State.wood >= b.costW && State.stone >= b.costS) {
            State.gold -= b.costG;
            State.wood -= b.costW;
            State.stone -= b.costS;
            State.b[type]++;
            if(b.capacity) State.maxPop += b.capacity;
            UI.log(`${b.name} errichtet.`, "important");
            UI.update();
        } else {
            UI.log("Zu wenig Ressourcen!", "combat");
        }
    },

    recruit: function() {
        if (State.b.barracks === 0) { UI.log("Kaserne ben√∂tigt!", "combat"); return; }
        
        if (State.gold >= 10 && State.weapons >= 1 && State.population > State.soldiers + 1) {
            State.gold -= 10;
            State.weapons -= 1;
            State.soldiers++;
            UI.log("Soldat rekrutiert.", "important");
            UI.update();
        } else {
            UI.log("Fehlt: Gold, Waffen oder Siedler.", "combat");
        }
    },

    changeTax: function(amount) {
        State.tax += amount;
        if(State.tax < 0) State.tax = 0;
        UI.update();
    }
};

/* --- UI HELPER --- */
const UI = {
    log: function(text, type = '') {
        const area = document.getElementById('log-area');
        const div = document.createElement('div');
        div.className = `log-entry ${type}`;
        div.innerHTML = `<strong>Tag ${State.day}:</strong> ${text}`;
        area.appendChild(div);
        area.scrollTop = area.scrollHeight;
    },

    update: function() {
        const s = State;
        // Helper Funktion f√ºr DOM Updates
        const set = (id, val) => document.getElementById(id).innerText = Math.floor(val);

        set('res-gold', s.gold);
        set('res-wood', s.wood);
        set('res-stone', s.stone);
        set('res-iron', s.iron);
        
        set('res-wheat', s.wheat);
        set('res-flour', s.flour);
        set('res-bread', s.bread);
        set('res-meat', s.meat);
        set('res-apple', s.apple);
        
        set('res-weapon', s.weapons);
        set('res-soldier', s.soldiers);
        set('res-pop', s.popularity);

        // Sidebar Status
        document.getElementById('stat-day').innerText = s.day;
        document.getElementById('stat-pop').innerText = `${s.population} / ${s.maxPop}`;
        document.getElementById('stat-tax').innerText = s.tax;

        // Counts
        document.getElementById('count-basic').innerText = `${s.b.woodcutter} / ${s.b.quarry} / ${s.b.ironmine}`;
        document.getElementById('count-food').innerText = (s.b.farm_apple + s.b.hunter + s.b.farm_wheat + s.b.bakery);
        document.getElementById('count-mil').innerText = (s.b.weaponsmith + s.b.barracks);
    },

    showModal: function(title, text) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-text').innerText = text;
        document.getElementById('modal-overlay').style.display = 'flex';
    },

    closeModal: function() {
        document.getElementById('modal-overlay').style.display = 'none';
        State.paused = false;
    }
};

// Start
Game.init();

</script>
</body>
</html>
